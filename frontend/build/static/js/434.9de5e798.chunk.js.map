{"version":3,"file":"static/js/434.9de5e798.chunk.js","mappings":"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","sources":["components/apps/transactionStudentModal.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback, useMemo, Suspense, lazy } from \"react\";\nimport { Dialog, DialogHeader, DialogBody, DialogFooter, Button, Spinner } from \"@material-tailwind/react\";\nimport { format } from \"date-fns\";\nimport { Config } from \"../config\";\nimport { XMarkIcon } from \"@heroicons/react/24/outline\";\nimport { useTuitionFeeData } from \"./hooks/useTuitionFeeData\";\nimport { usePaymentDistribution } from \"./hooks/usePaymentDistribution\";\nimport { useReceiptData } from \"./hooks/useReceiptData\";\n\nconst TransactionHeader = lazy(() => import(\"./transaction/TransactionHeader\"));\nconst TransactionTable = lazy(() => import(\"./transaction/TransactionTable\"));\nconst ReceiptView = lazy(() => import(\"./transaction/ReceiptView\"));\n\nconst MODAL_STATUS = {\n  UNSUBMITTED: \"unsubmitted\",\n  SUBMITTED: \"submitted\",\n  VIEWING_RECEIPT: \"viewing_receipt\",\n};\n\nconst TransactionStudentModal = ({ isOpen, onClose, mshs, studentName, studentClass, size, studentData = null }) => {\n  const domain = Config();\n  const [showReceipt, setShowReceipt] = useState(false);\n  const [noiDungHoaDown, setNoiDungHoaDown] = useState('');\n  const [selectedMaHP, setSelectedMaHP] = useState([]);\n  const [showToast, setShowToast] = useState(false);\n  const [toastMessage, setToastMessage] = useState(\"\");\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\n  const [showTable, setShowTable] = useState(false);\n  const [modalStatus, setModalStatus] = useState(MODAL_STATUS.UNSUBMITTED);\n  const [pendingInvoiceId, setPendingInvoiceId] = useState(null);\n  const [feesInitialized, setFeesInitialized] = useState(false);\n  const [processedFees, setProcessedFees] = useState([]);\n  const [isPrinting, setIsPrinting] = useState(false);\n\n  const dataRef = useRef({\n    mshs,\n    name: studentName,\n    grade: studentClass ? studentClass.charAt(0) : \"\",\n    class: studentClass ? studentClass.substring(1) : \"\",\n    sur_name: studentData?.sur_name || \"\",\n    full_name: studentData?.full_name || studentName,\n  });\n\n  useEffect(() => {\n    if (studentData) {\n      dataRef.current = {\n        ...dataRef.current,\n        ...studentData,\n        mshs: mshs || studentData.mshs,\n        name: studentData.name || studentName,\n        grade: studentData.grade || (studentClass ? studentClass.charAt(0) : \"\"),\n        class: studentData.class || (studentClass ? studentClass.substring(1) : \"\")\n      };\n    }\n  }, [studentData, mshs, studentName, studentClass]);\n\n  const currentDay = useMemo(() => format(new Date(), \"dd/MM/yyyy\"), []);\n\n  const {\n    loading: feeDataLoading,\n    feeTable,\n    currentMonth,\n    transactionId,\n    error: feeDataError,\n    fetchTuitionFeeData,\n    pendingInvoice,\n    totalFeeAmount,\n    deletePendingInvoice\n  } = useTuitionFeeData(mshs, isOpen);\n\n  useEffect(() => {\n    if (\n      feeTable?.processedFees &&\n      Array.isArray(feeTable.processedFees) &&\n      !feesInitialized\n    ) {\n      const initializedFees = feeTable.processedFees\n        .map(fee => ({\n          ...fee,\n          isChecked: true,\n          amount_paid: fee.amount_paid ?? fee.suggested_payment ?? 0,\n          note: fee.note ?? '',\n        }))\n        .sort((a, b) => {\n          const aIsHP = a.code && a.code.includes('HP');\n          const bIsHP = b.code && b.code.includes('HP');\n          if (aIsHP && !bIsHP) return -1;\n          if (!aIsHP && bIsHP) return 1;\n          return 0;\n        });\n      setProcessedFees(initializedFees);\n      setFeesInitialized(true);\n      if (initializedFees.length > 0 && currentMonth) {\n        const newSelectedMaHP = initializedFees.map(fee => fee.code);\n        setSelectedMaHP(newSelectedMaHP);\n        setNoiDungHoaDown(`THU ${newSelectedMaHP.join(\", \")} THÁNG ${currentMonth}`);\n      }\n    }\n  }, [feeTable, feesInitialized, currentMonth]);\n\n  useEffect(() => {\n    if (pendingInvoice && pendingInvoice.id) {\n      setPendingInvoiceId(pendingInvoice.id);\n    }\n  }, [pendingInvoice]);\n\n  const {\n    totalPaymentAmount,\n    setTotalPaymentAmount,\n    distributePayment,\n    handleTotalPaymentChange\n  } = usePaymentDistribution(processedFees, setProcessedFees);\n\n  const prepareTransactionData = useCallback(() => {\n    return processedFees\n      .filter(fee => fee.isChecked)\n      .map(fee => {\n        const amountPaid = fee.isAmountModified \n          ? Number(fee.amount_paid) \n          : (fee.suggested_payment || 0);\n        if (fee.isNewRow) {\n          return {\n            code: fee.code,\n            amount: amountPaid,\n            note: fee.note || \"\",\n            name: fee.name || fee.code,\n            isNewRow: true,\n            groupcode: fee.groupcode || \"OTHER\"\n          };\n        }\n        return {\n          code: fee.code,\n          amount: amountPaid,\n          note: fee.note || \"\"\n        };\n      });\n  }, [processedFees]);\n\n  const {\n    receiptData,\n    receiptRef,\n    pdfLoading,\n    isSubmitting,\n    showToast: receiptShowToast,\n    setShowToast: setReceiptShowToast,\n    toastMessage: receiptToastMessage,\n    setToastMessage: setReceiptToastMessage,\n    handlePdfAction,\n    generateReceiptAndSubmit\n  } = useReceiptData({\n    studentData: dataRef.current,\n    transactionId,\n    currentMonth,\n    noiDungHoa: noiDungHoaDown,\n    totalFeeAmount,\n    processedFees,\n    prepareTransactionData,\n    domain,\n    pendingInvoiceId,\n    onSuccess: async () => {\n      setPendingInvoiceId(null);\n      setModalStatus(MODAL_STATUS.SUBMITTED);\n      setShowReceipt(true);\n    }\n  });\n\n  useEffect(() => {\n    if (receiptShowToast) {\n      setShowToast(true);\n      setToastMessage(receiptToastMessage);\n      const timer = setTimeout(() => setShowToast(false), 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [receiptShowToast, receiptToastMessage]);\n\n  const handleNoiDungChange = useCallback((event) => {\n    setNoiDungHoaDown(event.target.value);\n  }, []);\n\n  useEffect(() => {\n    if (processedFees && processedFees.length > 0) {\n      setIsInitialLoad(false);\n      setShowTable(true);\n    }\n  }, [processedFees]);\n\n  useEffect(() => {\n    if (showReceipt) {\n      setModalStatus(MODAL_STATUS.VIEWING_RECEIPT);\n    } else if (modalStatus === MODAL_STATUS.VIEWING_RECEIPT) {\n      setModalStatus(MODAL_STATUS.SUBMITTED);\n    }\n  }, [showReceipt, modalStatus]);\n\n  const handleCheck = useCallback((code, status) => {\n    setProcessedFees(prev => {\n      const newData = prev.map(fee =>\n        fee.code === code ? { ...fee, isChecked: status } : fee\n      );\n      const checkedFees = newData.filter(fee => fee.isChecked);\n      const newSelectedMaHP = checkedFees.map(fee => fee.code);\n      setSelectedMaHP(newSelectedMaHP);\n      if (checkedFees.length > 0 && currentMonth) {\n        setNoiDungHoaDown(`THU ${newSelectedMaHP.join(\", \")} THÁNG ${currentMonth}`);\n      } else {\n        setNoiDungHoaDown('');\n      }\n      return newData;\n    });\n  }, [currentMonth]);\n\n  const handlePaidAmount = useCallback((code, amount_paid) => {\n    setProcessedFees(prev => prev.map(fee =>\n      fee.code === code ? { ...fee, amount_paid, isAmountModified: true } : fee\n    ));\n  }, []);\n\n  const handleDebt = useCallback((code, default_amount) => {\n    setProcessedFees(prev => prev.map(fee =>\n      fee.code === code ? { ...fee, default_amount } : fee\n    ));\n  }, []);\n\n  const handleNote = useCallback((code, note) => {\n    setProcessedFees(prev => prev.map(fee =>\n      fee.code === code ? { ...fee, note } : fee\n    ));\n  }, []);\n\n  const handleFeeCode = useCallback((code, newCode) => {\n    setProcessedFees(prev => prev.map(fee =>\n      fee.code === code ? { ...fee, code: newCode } : fee\n    ));\n  }, []);\n\n  const handleFeeName = useCallback((code, name) => {\n    setProcessedFees(prev => prev.map(fee =>\n      fee.code === code ? { ...fee, name } : fee\n    ));\n  }, []);\n\n  const addNewRow = useCallback(() => {\n    setProcessedFees(prev => [\n      ...prev,\n      {\n        code: `OT-${Date.now()}`,\n        name: \"\",\n        default_amount: 0,\n        opening_debt_balance: 0,\n        remaining_amount: 0,\n        suggested_payment: 0,\n        amount_paid: 0,\n        isNewRow: true,\n        isChecked: true,\n        groupcode: \"OTHER\",\n        note: \"\",\n      },\n    ]);\n  }, []);\n\n  const handlePrintPhieuNhapHoc = useCallback(async () => {\n  try {\n    setIsPrinting(true);\n    const currentMshs = dataRef.current.mshs;\n    \n    if (!currentMshs) {\n      setToastMessage(\"Không tìm thấy mã số học sinh\");\n      setShowToast(true);\n      setTimeout(() => setShowToast(false), 3000);\n      setIsPrinting(false);\n      return;\n    }\n    \n    // Fetch student data\n    const response = await fetch(`${domain}/api/students/search?mshs=${currentMshs}`, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        'Accept': 'application/json'\n      },\n    });\n    \n    if (!response.ok) {\n      throw new Error(`Lỗi khi lấy thông tin học sinh: ${response.statusText}`);\n    }\n    \n    const { data } = await response.json();\n    if (!data || !data.length) {\n      throw new Error(\"Không tìm thấy thông tin học sinh\");\n    }\n    const student = data[0];\n    \n    // Determine student status\n    const dayIn = new Date(student.day_in);\n    const now = new Date();\n    const interval = (now - dayIn) / (1000 * 60 * 60 * 24);\n    const isNewStudent = interval < 30;\n    const studentStatus = isNewStudent ? 'Mới' : 'Cũ';\n    const stayIn = student.stay_in ? 'Nội trú' : 'Bán trú';\n    \n    // Try to open as a window rather than a tab by specifying window features\n    const windowFeatures = \"width=800,height=600,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes\";\n    const printWindow = window.open('', '_blank', windowFeatures);\n    \n    if (!printWindow) {\n      throw new Error(\"Không thể mở cửa sổ in. Vui lòng kiểm tra cài đặt trình duyệt của bạn.\");\n    }\n    \n    // Write content directly to the window\n    printWindow.document.open();\n    printWindow.document.write(`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Phiếu Nhập Học - ${student.mshs}</title>\n          <meta charset=\"UTF-8\">\n          <style>\n            /* Critical fix: Set page size and prevent overflow */\n            @page {\n              size: A5 landscape;\n              margin: 0.5cm;\n            }\n            \n            /* Base styles */\n            html, body {\n              margin: 0;\n              padding: 0;\n              font-family: Arial, sans-serif;\n              font-size: 11pt;\n              background-color: white;\n              width: 210mm;\n              height: 140mm;\n              overflow: hidden;\n              box-sizing: border-box; /* Ensure padding is included */\n            }\n            \n            /* Main container */\n            .phieu-nhap-hoc {\n              padding: 10mm;\n              page-break-inside: avoid;\n              page-break-after: avoid;\n              page-break-before: avoid;\n              box-sizing: border-box;\n              max-height: 128mm; /* Ensure content fits within A5 height */\n            }\n            \n            /* School info */\n            .school-info {\n              text-align: center;\n              margin-bottom: 15px;\n            }\n            \n            .header {\n              font-weight: bold;\n              text-align: center;\n              font-size: 16px;\n              margin-top: 10px;\n            }\n            \n            /* Student info table */\n            table {\n              border-collapse: collapse;\n              width: 100%;\n              margin-bottom: 20px;\n            }\n            \n            table, th, td {\n              border: none;\n              box-sizing: border-box;\n            }\n            \n            td.rightCol_title {\n              width: 130px;\n            }\n            \n            th, td {\n              padding: 5px;\n              text-align: left;\n            }\n            \n            .student-info td:first-child {\n              font-weight: bold;\n              width: 150px;               \n            }\n            \n            .importantCol {\n              font-weight: bold;\n              font-size: 15px;\n            }\n            \n            /* Footer notes */\n            p {\n              margin: 5px 0;\n              line-height: 1.5;\n              font-size: 13px;\n            }\n            \n            /* Print-specific styles */\n            @media print {\n              html, body {\n                width: 210mm;\n                height: 140mm;\n                overflow: hidden;\n                print-color-adjust: exact;\n                -webkit-print-color-adjust: exact;\n              }\n              \n              .no-print {\n                display: none !important;\n              }\n            }\n            \n            /* Controls */\n            .controls {\n              position: fixed;\n              bottom: 20px;\n              left: 0;\n              width: 100%;\n              text-align: center;\n              z-index: 1000;\n            }\n            \n            .btn {\n              padding: 10px 20px;\n              margin: 0 5px;\n              border: none;\n              border-radius: 4px;\n              cursor: pointer;\n              font-weight: bold;\n              color: white;\n            }\n            \n            .btn-print {\n              background-color: #4a6cf7;\n            }\n            \n            .btn-close {\n              background-color: #6c757d;\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"phieu-nhap-hoc\">\n            <div class=\"school-info\">\n              <div class=\"header\">CÔNG TY TNHH GIÁO DỤC THANH TÍN</div>\n              <div>227 Tân Thắng, Q. Tân Phú TP.HCM</div>\n              <div>ĐT: 028 3810 2686</div>\n            </div>\n            \n            <div class=\"header\" style=\"margin-bottom: 30px;\">PHIẾU NHẬP HỌC</div>\n            \n            <table class=\"student-info\">\n              <tr>\n                <td>Họ và tên:</td>\n                <td colspan=\"2\" class=\"leftCol-content\">${student.sur_name} ${student.name}</td>\n                <td> </td>\n                <td class=\"rightCol_title\">Mã số học sinh:</td>\n                <td colspan=\"4\">${student.mshs}</td>\n              </tr>\n              <tr>\n                <td>Ngày sinh:</td>\n                <td colspan=\"2\">${student.day_of_birth ? format(new Date(student.day_of_birth), 'dd/MM/yyyy') : ''}</td>\n                <td> </td>\n                <td class=\"rightCol_title\">Giới tính:</td>\n                <td colspan=\"4\">${student.gender === 'male' ? 'Nam' : 'Nữ'}</td>\n              </tr>\n              <tr>\n                <td>Lớp:</td>\n                <td colspan=\"2\" class=\"leftCol-content\">${student.grade}${student.class}</td>\n                <td> </td>\n                <td colspan=\"4\" class=\"importantCol\">Ngày nhập học: ${student.day_in ? format(new Date(student.day_in), 'dd/MM/yyyy') : format(new Date(), 'dd/MM/yyyy')}</td>\n              </tr>\n              <tr>\n                <td>Địa chỉ:</td>\n                <td colspan=\"7\">${student.address || ''}</td>\n              </tr>\n              <tr>\n                <td>Phụ huynh:</td>\n                <td colspan=\"2\" class=\"leftCol-content\">${student.parent_name || ''}</td>\n                <td> </td>\n                <td class=\"rightCol_title\">Điện thoại:</td>\n                <td>${student.phone_number || ''}</td>\n              </tr>\n              <tr>\n                <td>Tình trạng HS:</td>\n                <td colspan=\"2\" class=\"leftCol-content\">${studentStatus}</td>\n                <td> </td>\n                <td class=\"rightCol_title\">Phân loại:</td>\n                <td colspan=\"4\">${stayIn}</td>\n              </tr>\n              <tr>\n                <td colspan=\"3\" style=\"margin: 20px 0 5px; padding-top: 20px\">\n                  <p>+ Xin vui lòng kiểm tra lại danh sách lớp trước khi vào học.</p>\n                  <p>+ Học sinh nội trú phải nhập nội trú trước 1 ngày.</p></td>\n                <td colspan=\"5\" style=\"text-align: center; margin: 20px 0 5px; padding-top: 20px\">\n                  Ngày ${format(new Date(), 'dd')} tháng ${format(new Date(), 'MM')} năm ${format(new Date(), 'yyyy')}<br/>\n                  <div>Người lập phiếu</div>\n                </td>\n              </tr>\n            </table>\n          \n          </div>\n         \n          \n          <script>\n            // Wait for all resources to load before printing\n            window.onload = function() {\n              // Add a slight delay to ensure everything is rendered\n              setTimeout(function() {\n                window.print();\n                \n                // Set up event listener for after print\n                window.addEventListener('afterprint', function() {\n                  // Auto close after printing with a small delay\n                  setTimeout(function() {\n                    window.close();\n                  }, 500);\n                });\n              }, 1000); // Increased delay for rendering\n            };\n          </script>\n        </body>\n      </html>\n    `);\n    printWindow.document.close();\n    \n    setToastMessage(\"Đã mở phiếu nhập học để in\");\n    setShowToast(true);\n    setTimeout(() => setShowToast(false), 3000);\n  } catch (error) {\n    console.error(\"Error generating admission form:\", error);\n    setToastMessage(`Lỗi khi tạo phiếu nhập học: ${error.message}`);\n    setShowToast(true);\n    setTimeout(() => setShowToast(false), 3000);\n  } finally {\n    setIsPrinting(false);\n  }\n}, [domain, format]);\n\n  const handleSubmitTransaction = useCallback(async () => {\n    try {\n      if (!dataRef.current) {\n        setToastMessage(\"Không có dữ liệu học sinh\");\n        setShowToast(true);\n        return;\n      }\n      \n      const isChecked = processedFees.filter((fee) => fee.isChecked);\n      if (!isChecked.length) {\n        setToastMessage(\"Chọn học phí muốn thu\");\n        setShowToast(true);\n        return;\n      }\n      \n      await generateReceiptAndSubmit();\n    } catch (error) {\n      console.error(\"Error in transaction submission:\", error);\n      setToastMessage(`Đã xảy ra lỗi: ${error.message}`);\n      setShowToast(true);\n    }\n  }, [dataRef, processedFees, generateReceiptAndSubmit]);\n\n  const formatCurrency = useCallback((amount) => {\n    if (!amount && amount !== 0) return \"0\";\n    return parseFloat(amount).toLocaleString(\"vi-VN\");\n  }, []);\n\n  const canViewReceipt = modalStatus === MODAL_STATUS.SUBMITTED || \n                        (showTable && processedFees.some(fee => fee.isChecked));\n\n  if (!isOpen) return null;\n\n  return (\n    <Dialog open={isOpen} \n            handler={onClose} \n            size={size || \"xxl\"}\n            className=\"max-w-6xl mx-auto\">\n      <DialogHeader className=\"flex justify-between items-center p-4 border-b\">\n        <h3 className=\"font-bold text-lg\">Thu học phí - {studentName} ({mshs})</h3>\n        <Button\n          variant=\"text\"\n          color=\"blue-gray\"\n          onClick={onClose}\n          className=\"p-2 rounded-full hover:bg-gray-200 transition-colors\"\n        >\n          <XMarkIcon className=\"h-6 w-6\" />\n        </Button>\n      </DialogHeader>\n      \n      <DialogBody className=\"p-0 overflow-y-auto max-h-[70vh]\">\n        <div className=\"transition-opacity duration-300 ease-in-out\">\n          {!showReceipt ? (\n            <div className=\"bg-white animate-fade-in\">\n              <div className=\"p-4 space-y-4\">\n                <Suspense fallback={<div className=\"flex justify-center py-4\"><Spinner className=\"h-8 w-8 text-violet-800\" /></div>}>\n                  <TransactionHeader \n                    studentName={studentName}\n                    studentData={dataRef.current}\n                    transactionId={transactionId}\n                    currentDay={currentDay}\n                    currentMonth={currentMonth}\n                    noiDungHoaDown={noiDungHoaDown}\n                    onNoiDungChange={handleNoiDungChange}\n                  />\n                </Suspense>\n                \n                {(feeDataLoading && isInitialLoad) ? (\n                  <div className=\"flex flex-col items-center justify-center p-8\">\n                    <Spinner className=\"h-12 w-12 text-violet-800\" />\n                    <p className=\"mt-4 text-gray-700\">Đang tải dữ liệu...</p>\n                  </div>\n                ) : feeDataError ? (\n                  <div className=\"text-red-500 text-center p-4\">\n                    <p className=\"text-xl font-bold mb-2\">Lỗi khi tải dữ liệu</p>\n                    <p>{feeDataError}</p>\n                  </div>\n                ) : (!processedFees || processedFees.length === 0) ? (\n                  <p className=\"text-gray-700 text-center py-4\">Không có dữ liệu học phí cho học sinh này.</p>\n                ) : showTable ? (\n                  <Suspense fallback={\n                    <div className=\"w-full flex justify-center items-center py-8\">\n                      <Spinner className=\"h-8 w-8 text-violet-800\" />\n                    </div>\n                  }>\n                    <TransactionTable \n                      processedFees={processedFees}\n                      feeTable={feeTable}\n                      handleCheck={handleCheck}\n                      handlePaidAmount={handlePaidAmount}\n                      handleDebt={handleDebt}\n                      handleNote={handleNote}\n                      handleFeeCode={handleFeeCode}\n                      handleFeeName={handleFeeName}\n                      formatCurrency={formatCurrency}\n                      addNewRow={addNewRow}\n                      totalPaymentAmount={totalPaymentAmount}\n                      setTotalPaymentAmount={setTotalPaymentAmount}\n                      distributePayment={distributePayment}\n                      handleTotalPaymentChange={handleTotalPaymentChange}\n                    />\n                  </Suspense>\n                ) : (\n                  <div className=\"w-full flex justify-center items-center py-8\">\n                    <Spinner className=\"h-8 w-8 text-violet-800\" />\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"flex items-center justify-end p-4 gap-4 border-t bg-gray-50\">\n                <Button\n                  className=\"bg-gray-200 text-gray-700 hover:bg-gray-300 shadow-none\"\n                  onClick={onClose}\n                >\n                  Đóng\n                </Button>\n                <Button\n                  className={isSubmitting ? \"bg-violet-300 text-white shadow-md\" : \"bg-violet-700 hover:bg-violet-800 text-white shadow-md\"}\n                  disabled={isSubmitting || !showTable || modalStatus === MODAL_STATUS.SUBMITTED || !processedFees.some(fee => fee.isChecked)}\n                  onClick={handleSubmitTransaction}\n                >\n                  {modalStatus === MODAL_STATUS.SUBMITTED ? \"Đã thu học phí\" : \"Thu Học Phí\"}\n                </Button>\n                <Button\n                  className={isPrinting ? \"bg-green-300 text-white shadow-md\" : \"bg-green-600 hover:bg-green-700 text-white shadow-md\"}\n                  disabled={isPrinting}\n                  onClick={handlePrintPhieuNhapHoc}\n                >\n                  {isPrinting ? (\n                    <div className=\"flex items-center gap-2\">\n                      <Spinner className=\"h-4 w-4 animate-spin\" />\n                      Đang tải...\n                    </div>\n                  ) : (\n                    \"In phiếu nhập học\"\n                  )}\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <Suspense fallback={<div className=\"flex justify-center py-8\"><Spinner className=\"h-8 w-8 text-violet-800\" /></div>}>\n              <div className=\"animate-fade-in\">\n                <ReceiptView \n                  onBack={() => setShowReceipt(false)}\n                  onClose={onClose}\n                  receiptRef={receiptRef}\n                  receiptData={receiptData}\n                  handlePdfAction={handlePdfAction}\n                  pdfLoading={pdfLoading}\n                  isSubmitting={isSubmitting}\n                />\n              </div>\n            </Suspense>\n          )}\n        </div>\n      </DialogBody>\n   \n    </Dialog>\n  );\n};\n\nexport default TransactionStudentModal;"],"names":["TransactionHeader","lazy","TransactionTable","ReceiptView","MODAL_STATUS","_ref","isOpen","onClose","mshs","studentName","studentClass","size","studentData","domain","Config","showReceipt","setShowReceipt","useState","noiDungHoaDown","setNoiDungHoaDown","selectedMaHP","setSelectedMaHP","showToast","setShowToast","toastMessage","setToastMessage","isInitialLoad","setIsInitialLoad","showTable","setShowTable","modalStatus","setModalStatus","pendingInvoiceId","setPendingInvoiceId","feesInitialized","setFeesInitialized","processedFees","setProcessedFees","isPrinting","setIsPrinting","dataRef","useRef","name","grade","charAt","class","substring","sur_name","full_name","useEffect","current","currentDay","useMemo","format","Date","loading","feeDataLoading","feeTable","currentMonth","transactionId","error","feeDataError","fetchTuitionFeeData","pendingInvoice","totalFeeAmount","deletePendingInvoice","useTuitionFeeData","Array","isArray","initializedFees","map","fee","_ref2","_fee$amount_paid","_fee$note","isChecked","amount_paid","suggested_payment","note","sort","a","b","aIsHP","code","includes","bIsHP","length","newSelectedMaHP","join","id","totalPaymentAmount","setTotalPaymentAmount","distributePayment","handleTotalPaymentChange","usePaymentDistribution","prepareTransactionData","useCallback","filter","amountPaid","isAmountModified","Number","isNewRow","amount","groupcode","receiptData","receiptRef","pdfLoading","isSubmitting","receiptShowToast","setReceiptShowToast","receiptToastMessage","setReceiptToastMessage","handlePdfAction","generateReceiptAndSubmit","useReceiptData","noiDungHoa","onSuccess","async","timer","setTimeout","clearTimeout","handleNoiDungChange","event","target","value","handleCheck","status","prev","newData","checkedFees","handlePaidAmount","handleDebt","default_amount","handleNote","handleFeeCode","newCode","handleFeeName","addNewRow","now","opening_debt_balance","remaining_amount","handlePrintPhieuNhapHoc","currentMshs","response","fetch","method","headers","localStorage","getItem","ok","Error","statusText","data","json","student","dayIn","day_in","studentStatus","stayIn","stay_in","windowFeatures","printWindow","window","open","document","write","day_of_birth","gender","address","parent_name","phone_number","close","console","message","handleSubmitTransaction","formatCurrency","parseFloat","toLocaleString","some","_jsxs","Dialog","handler","className","children","DialogHeader","_jsx","Button","variant","color","onClick","XMarkIcon","DialogBody","Suspense","fallback","Spinner","onBack","onNoiDungChange","disabled"],"sourceRoot":""}