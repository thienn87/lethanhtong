"use strict";(self.webpackChunktranslate_editor=self.webpackChunktranslate_editor||[]).push([[434],{9434:(n,e,t)=>{t.r(e),t.d(e,{default:()=>b});var a=t(5043),s=t(2200),i=t(2802),o=t(544),d=t(7591),l=t(4058),r=t(6468),c=t(7176),h=t(579);const u=(0,a.lazy)((()=>t.e(244).then(t.bind(t,1244)))),m=(0,a.lazy)((()=>t.e(31).then(t.bind(t,31)))),p=(0,a.lazy)((()=>t.e(872).then(t.bind(t,9872)))),g="unsubmitted",f="submitted",x="viewing_receipt",b=n=>{let{isOpen:e,onClose:t,mshs:b,studentName:y,studentClass:w,size:v,studentData:N=null}=n;const C=(0,o.T)(),[j,k]=(0,a.useState)(!1),[T,_]=(0,a.useState)(""),[S,P]=(0,a.useState)([]),[D,$]=(0,a.useState)(!1),[A,H]=(0,a.useState)(""),[M,E]=(0,a.useState)(!0),[z,G]=(0,a.useState)(!1),[F,I]=(0,a.useState)(g),[R,B]=(0,a.useState)(null),[L,O]=(0,a.useState)(!1),[K,U]=(0,a.useState)([]),[Y,V]=(0,a.useState)(!1),Q=(0,a.useRef)({mshs:b,name:y,grade:w?w.charAt(0):"",class:w?w.substring(1):"",sur_name:(null===N||void 0===N?void 0:N.sur_name)||"",full_name:(null===N||void 0===N?void 0:N.full_name)||y});(0,a.useEffect)((()=>{N&&(Q.current={...Q.current,...N,mshs:b||N.mshs,name:N.name||y,grade:N.grade||(w?w.charAt(0):""),class:N.class||(w?w.substring(1):"")})}),[N,b,y,w]);const W=(0,a.useMemo)((()=>(0,i.GP)(new Date,"dd/MM/yyyy")),[]),{loading:X,feeTable:q,currentMonth:J,transactionId:Z,error:nn,fetchTuitionFeeData:en,pendingInvoice:tn,totalFeeAmount:an,deletePendingInvoice:sn}=(0,l._)(b,e);(0,a.useEffect)((()=>{if(null!==q&&void 0!==q&&q.processedFees&&Array.isArray(q.processedFees)&&!L){const n=q.processedFees.map((n=>{var e,t,a;return{...n,isChecked:!0,amount_paid:null!==(e=null!==(t=n.amount_paid)&&void 0!==t?t:n.suggested_payment)&&void 0!==e?e:0,note:null!==(a=n.note)&&void 0!==a?a:""}})).sort(((n,e)=>{const t=n.code&&n.code.includes("HP"),a=e.code&&e.code.includes("HP");return t&&!a?-1:!t&&a?1:0}));if(U(n),O(!0),n.length>0&&J){const e=n.map((n=>n.code));P(e),_(`THU ${e.join(", ")} TH\xc1NG ${J}`)}}}),[q,L,J]),(0,a.useEffect)((()=>{tn&&tn.id&&B(tn.id)}),[tn]);const{totalPaymentAmount:on,setTotalPaymentAmount:dn,distributePayment:ln,handleTotalPaymentChange:rn}=(0,r.Y)(K,U),cn=(0,a.useCallback)((()=>K.filter((n=>n.isChecked)).map((n=>{const e=n.isAmountModified?Number(n.amount_paid):n.suggested_payment||0;return n.isNewRow?{code:n.code,amount:e,note:n.note||"",name:n.name||n.code,isNewRow:!0,groupcode:n.groupcode||"OTHER"}:{code:n.code,amount:e,note:n.note||""}}))),[K]),{receiptData:hn,receiptRef:un,pdfLoading:mn,isSubmitting:pn,showToast:gn,setShowToast:fn,toastMessage:xn,setToastMessage:bn,handlePdfAction:yn,generateReceiptAndSubmit:wn}=(0,c._)({studentData:Q.current,transactionId:Z,currentMonth:J,noiDungHoa:T,totalFeeAmount:an,processedFees:K,prepareTransactionData:cn,domain:C,pendingInvoiceId:R,onSuccess:async()=>{B(null),I(f),k(!0)}});(0,a.useEffect)((()=>{if(gn){$(!0),H(xn);const n=setTimeout((()=>$(!1)),3e3);return()=>clearTimeout(n)}}),[gn,xn]);const vn=(0,a.useCallback)((n=>{_(n.target.value)}),[]);(0,a.useEffect)((()=>{K&&K.length>0&&(E(!1),G(!0))}),[K]),(0,a.useEffect)((()=>{j?I(x):F===x&&I(f)}),[j,F]);const Nn=(0,a.useCallback)(((n,e)=>{U((t=>{const a=t.map((t=>t.code===n?{...t,isChecked:e}:t)),s=a.filter((n=>n.isChecked)),i=s.map((n=>n.code));return P(i),s.length>0&&J?_(`THU ${i.join(", ")} TH\xc1NG ${J}`):_(""),a}))}),[J]),Cn=(0,a.useCallback)(((n,e)=>{U((t=>t.map((t=>t.code===n?{...t,amount_paid:e,isAmountModified:!0}:t))))}),[]),jn=(0,a.useCallback)(((n,e)=>{U((t=>t.map((t=>t.code===n?{...t,default_amount:e}:t))))}),[]),kn=(0,a.useCallback)(((n,e)=>{U((t=>t.map((t=>t.code===n?{...t,note:e}:t))))}),[]),Tn=(0,a.useCallback)(((n,e)=>{U((t=>t.map((t=>t.code===n?{...t,code:e}:t))))}),[]),_n=(0,a.useCallback)(((n,e)=>{U((t=>t.map((t=>t.code===n?{...t,name:e}:t))))}),[]),Sn=(0,a.useCallback)((()=>{U((n=>[...n,{code:`OT-${Date.now()}`,name:"",default_amount:0,opening_debt_balance:0,remaining_amount:0,suggested_payment:0,amount_paid:0,isNewRow:!0,isChecked:!0,groupcode:"OTHER",note:""}]))}),[]),Pn=(0,a.useCallback)((async()=>{try{V(!0);const n=Q.current.mshs;if(!n)return H("Kh\xf4ng t\xecm th\u1ea5y m\xe3 s\u1ed1 h\u1ecdc sinh"),$(!0),setTimeout((()=>$(!1)),3e3),void V(!1);const e=await fetch(`${C}/api/students/search?mshs=${n}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}});if(!e.ok)throw new Error(`L\u1ed7i khi l\u1ea5y th\xf4ng tin h\u1ecdc sinh: ${e.statusText}`);const{data:t}=await e.json();if(!t||!t.length)throw new Error("Kh\xf4ng t\xecm th\u1ea5y th\xf4ng tin h\u1ecdc sinh");const a=t[0],s=new Date(a.day_in),o=new Date,d=(o-s)/864e5<30?"M\u1edbi":"C\u0169",l=a.stay_in?"N\u1ed9i tr\xfa":"B\xe1n tr\xfa",r="width=800,height=600,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes",c=window.open("","_blank",r);if(!c)throw new Error("Kh\xf4ng th\u1ec3 m\u1edf c\u1eeda s\u1ed5 in. Vui l\xf2ng ki\u1ec3m tra c\xe0i \u0111\u1eb7t tr\xecnh duy\u1ec7t c\u1ee7a b\u1ea1n.");c.document.open(),c.document.write(`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Phi\u1ebfu Nh\u1eadp H\u1ecdc - ${a.mshs}</title>\n          <meta charset="UTF-8">\n          <style>\n            /* Critical fix: Set page size and prevent overflow */\n            @page {\n              size: A5 landscape;\n              margin: 0.5cm;\n            }\n            \n            /* Base styles */\n            html, body {\n              margin: 0;\n              padding: 0;\n              font-family: Arial, sans-serif;\n              font-size: 11pt;\n              background-color: white;\n              width: 210mm;\n              height: 140mm;\n              overflow: hidden;\n              box-sizing: border-box; /* Ensure padding is included */\n            }\n            \n            /* Main container */\n            .phieu-nhap-hoc {\n              padding: 10mm;\n              page-break-inside: avoid;\n              page-break-after: avoid;\n              page-break-before: avoid;\n              box-sizing: border-box;\n              max-height: 128mm; /* Ensure content fits within A5 height */\n            }\n            \n            /* School info */\n            .school-info {\n              text-align: center;\n              margin-bottom: 15px;\n            }\n            \n            .header {\n              font-weight: bold;\n              text-align: center;\n              font-size: 16px;\n              margin-top: 10px;\n            }\n            \n            /* Student info table */\n            table {\n              border-collapse: collapse;\n              width: 100%;\n              margin-bottom: 20px;\n            }\n            \n            table, th, td {\n              border: none;\n              box-sizing: border-box;\n            }\n            \n            td.rightCol_title {\n              width: 130px;\n            }\n            \n            th, td {\n              padding: 5px;\n              text-align: left;\n            }\n            \n            .student-info td:first-child {\n              font-weight: bold;\n              width: 150px;               \n            }\n            \n            .importantCol {\n              font-weight: bold;\n              font-size: 15px;\n            }\n            \n            /* Footer notes */\n            p {\n              margin: 5px 0;\n              line-height: 1.5;\n              font-size: 13px;\n            }\n            \n            /* Print-specific styles */\n            @media print {\n              html, body {\n                width: 210mm;\n                height: 140mm;\n                overflow: hidden;\n                print-color-adjust: exact;\n                -webkit-print-color-adjust: exact;\n              }\n              \n              .no-print {\n                display: none !important;\n              }\n            }\n            \n            /* Controls */\n            .controls {\n              position: fixed;\n              bottom: 20px;\n              left: 0;\n              width: 100%;\n              text-align: center;\n              z-index: 1000;\n            }\n            \n            .btn {\n              padding: 10px 20px;\n              margin: 0 5px;\n              border: none;\n              border-radius: 4px;\n              cursor: pointer;\n              font-weight: bold;\n              color: white;\n            }\n            \n            .btn-print {\n              background-color: #4a6cf7;\n            }\n            \n            .btn-close {\n              background-color: #6c757d;\n            }\n          </style>\n        </head>\n        <body>\n          <div class="phieu-nhap-hoc">\n            <div class="school-info">\n              <div class="header">C\xd4NG TY TNHH GI\xc1O D\u1ee4C THANH T\xcdN</div>\n              <div>227 T\xe2n Th\u1eafng, Q. T\xe2n Ph\xfa TP.HCM</div>\n              <div>\u0110T: 028 3810 2686</div>\n            </div>\n            \n            <div class="header" style="margin-bottom: 30px;">PHI\u1ebeU NH\u1eacP H\u1eccC</div>\n            \n            <table class="student-info">\n              <tr>\n                <td>H\u1ecd v\xe0 t\xean:</td>\n                <td colspan="2" class="leftCol-content">${a.sur_name} ${a.name}</td>\n                <td>\xa0</td>\n                <td class="rightCol_title">M\xe3 s\u1ed1 h\u1ecdc sinh:</td>\n                <td colspan="4">${a.mshs}</td>\n              </tr>\n              <tr>\n                <td>Ng\xe0y sinh:</td>\n                <td colspan="2">${a.day_of_birth?(0,i.GP)(new Date(a.day_of_birth),"dd/MM/yyyy"):""}</td>\n                <td>\xa0</td>\n                <td class="rightCol_title">Gi\u1edbi t\xednh:</td>\n                <td colspan="4">${"male"===a.gender?"Nam":"N\u1eef"}</td>\n              </tr>\n              <tr>\n                <td>L\u1edbp:</td>\n                <td colspan="2" class="leftCol-content">${a.grade}${a.class}</td>\n                <td>\xa0</td>\n                <td colspan="4" class="importantCol">Ng\xe0y nh\u1eadp h\u1ecdc: ${a.day_in?(0,i.GP)(new Date(a.day_in),"dd/MM/yyyy"):(0,i.GP)(new Date,"dd/MM/yyyy")}</td>\n              </tr>\n              <tr>\n                <td>\u0110\u1ecba ch\u1ec9:</td>\n                <td colspan="7">${a.address||""}</td>\n              </tr>\n              <tr>\n                <td>Ph\u1ee5 huynh:</td>\n                <td colspan="2" class="leftCol-content">${a.parent_name||""}</td>\n                <td>\xa0</td>\n                <td class="rightCol_title">\u0110i\u1ec7n tho\u1ea1i:</td>\n                <td>${a.phone_number||""}</td>\n              </tr>\n              <tr>\n                <td>T\xecnh tr\u1ea1ng HS:</td>\n                <td colspan="2" class="leftCol-content">${d}</td>\n                <td>\xa0</td>\n                <td class="rightCol_title">Ph\xe2n lo\u1ea1i:</td>\n                <td colspan="4">${l}</td>\n              </tr>\n              <tr>\n                <td colspan="3" style="margin: 20px 0 5px; padding-top: 20px">\n                  <p>+ Xin vui l\xf2ng ki\u1ec3m tra l\u1ea1i danh s\xe1ch l\u1edbp tr\u01b0\u1edbc khi v\xe0o h\u1ecdc.</p>\n                  <p>+ H\u1ecdc sinh n\u1ed9i tr\xfa ph\u1ea3i nh\u1eadp n\u1ed9i tr\xfa tr\u01b0\u1edbc 1 ng\xe0y.</p></td>\n                <td colspan="5" style="text-align: center; margin: 20px 0 5px; padding-top: 20px">\n                  Ng\xe0y ${(0,i.GP)(new Date,"dd")} th\xe1ng ${(0,i.GP)(new Date,"MM")} n\u0103m ${(0,i.GP)(new Date,"yyyy")}<br/>\n                  <div>Ng\u01b0\u1eddi l\u1eadp phi\u1ebfu</div>\n                </td>\n              </tr>\n            </table>\n          \n          </div>\n         \n          \n          <script>\n            // Wait for all resources to load before printing\n            window.onload = function() {\n              // Add a slight delay to ensure everything is rendered\n              setTimeout(function() {\n                window.print();\n                \n                // Set up event listener for after print\n                window.addEventListener('afterprint', function() {\n                  // Auto close after printing with a small delay\n                  setTimeout(function() {\n                    window.close();\n                  }, 500);\n                });\n              }, 1000); // Increased delay for rendering\n            };\n          <\/script>\n        </body>\n      </html>\n    `),c.document.close(),H("\u0110\xe3 m\u1edf phi\u1ebfu nh\u1eadp h\u1ecdc \u0111\u1ec3 in"),$(!0),setTimeout((()=>$(!1)),3e3)}catch(n){console.error("Error generating admission form:",n),H(`L\u1ed7i khi t\u1ea1o phi\u1ebfu nh\u1eadp h\u1ecdc: ${n.message}`),$(!0),setTimeout((()=>$(!1)),3e3)}finally{V(!1)}}),[C,i.GP]),Dn=(0,a.useCallback)((async()=>{try{if(!Q.current)return H("Kh\xf4ng c\xf3 d\u1eef li\u1ec7u h\u1ecdc sinh"),void $(!0);if(!K.filter((n=>n.isChecked)).length)return H("Ch\u1ecdn h\u1ecdc ph\xed mu\u1ed1n thu"),void $(!0);await wn()}catch(n){console.error("Error in transaction submission:",n),H(`\u0110\xe3 x\u1ea3y ra l\u1ed7i: ${n.message}`),$(!0)}}),[Q,K,wn]),$n=(0,a.useCallback)((n=>n||0===n?parseFloat(n).toLocaleString("vi-VN"):"0"),[]);F===f||z&&K.some((n=>n.isChecked));return e?(0,h.jsxs)(s.Dialog,{open:e,handler:t,size:v||"xxl",className:"max-w-6xl mx-auto",children:[(0,h.jsxs)(s.DialogHeader,{className:"flex justify-between items-center p-4 border-b",children:[(0,h.jsxs)("h3",{className:"font-bold text-lg",children:["Thu h\u1ecdc ph\xed - ",y," (",b,")"]}),(0,h.jsx)(s.Button,{variant:"text",color:"blue-gray",onClick:t,className:"p-2 rounded-full hover:bg-gray-200 transition-colors",children:(0,h.jsx)(d.A,{className:"h-6 w-6"})})]}),(0,h.jsx)(s.DialogBody,{className:"p-0 overflow-y-auto max-h-[70vh]",children:(0,h.jsx)("div",{className:"transition-opacity duration-300 ease-in-out",children:j?(0,h.jsx)(a.Suspense,{fallback:(0,h.jsx)("div",{className:"flex justify-center py-8",children:(0,h.jsx)(s.Spinner,{className:"h-8 w-8 text-violet-800"})}),children:(0,h.jsx)("div",{className:"animate-fade-in",children:(0,h.jsx)(p,{onBack:()=>k(!1),onClose:t,receiptRef:un,receiptData:hn,handlePdfAction:yn,pdfLoading:mn,isSubmitting:pn})})}):(0,h.jsxs)("div",{className:"bg-white animate-fade-in",children:[(0,h.jsxs)("div",{className:"p-4 space-y-4",children:[(0,h.jsx)(a.Suspense,{fallback:(0,h.jsx)("div",{className:"flex justify-center py-4",children:(0,h.jsx)(s.Spinner,{className:"h-8 w-8 text-violet-800"})}),children:(0,h.jsx)(u,{studentName:y,studentData:Q.current,transactionId:Z,currentDay:W,currentMonth:J,noiDungHoaDown:T,onNoiDungChange:vn})}),X&&M?(0,h.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",children:[(0,h.jsx)(s.Spinner,{className:"h-12 w-12 text-violet-800"}),(0,h.jsx)("p",{className:"mt-4 text-gray-700",children:"\u0110ang t\u1ea3i d\u1eef li\u1ec7u..."})]}):nn?(0,h.jsxs)("div",{className:"text-red-500 text-center p-4",children:[(0,h.jsx)("p",{className:"text-xl font-bold mb-2",children:"L\u1ed7i khi t\u1ea3i d\u1eef li\u1ec7u"}),(0,h.jsx)("p",{children:nn})]}):K&&0!==K.length?z?(0,h.jsx)(a.Suspense,{fallback:(0,h.jsx)("div",{className:"w-full flex justify-center items-center py-8",children:(0,h.jsx)(s.Spinner,{className:"h-8 w-8 text-violet-800"})}),children:(0,h.jsx)(m,{processedFees:K,feeTable:q,handleCheck:Nn,handlePaidAmount:Cn,handleDebt:jn,handleNote:kn,handleFeeCode:Tn,handleFeeName:_n,formatCurrency:$n,addNewRow:Sn,totalPaymentAmount:on,setTotalPaymentAmount:dn,distributePayment:ln,handleTotalPaymentChange:rn})}):(0,h.jsx)("div",{className:"w-full flex justify-center items-center py-8",children:(0,h.jsx)(s.Spinner,{className:"h-8 w-8 text-violet-800"})}):(0,h.jsx)("p",{className:"text-gray-700 text-center py-4",children:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u h\u1ecdc ph\xed cho h\u1ecdc sinh n\xe0y."})]}),(0,h.jsxs)("div",{className:"flex items-center justify-end p-4 gap-4 border-t bg-gray-50",children:[(0,h.jsx)(s.Button,{className:"bg-gray-200 text-gray-700 hover:bg-gray-300 shadow-none",onClick:t,children:"\u0110\xf3ng"}),(0,h.jsx)(s.Button,{className:pn?"bg-violet-300 text-white shadow-md":"bg-violet-700 hover:bg-violet-800 text-white shadow-md",disabled:pn||!z||F===f||!K.some((n=>n.isChecked)),onClick:Dn,children:F===f?"\u0110\xe3 thu h\u1ecdc ph\xed":"Thu H\u1ecdc Ph\xed"}),(0,h.jsx)(s.Button,{className:Y?"bg-green-300 text-white shadow-md":"bg-green-600 hover:bg-green-700 text-white shadow-md",disabled:Y,onClick:Pn,children:Y?(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)(s.Spinner,{className:"h-4 w-4 animate-spin"}),"\u0110ang t\u1ea3i..."]}):"In phi\u1ebfu nh\u1eadp h\u1ecdc"})]})]})})})]}):null}}}]);
//# sourceMappingURL=434.9de5e798.chunk.js.map